# SelfVue
- 参考 https://www.cnblogs.com/lishanlei/p/8423407.html
- Vue双向绑定原理的实现

---

## I - Vue双向绑定的原理
Vue的双向绑定是由数据劫持结合发布者-订阅者模式实现的
1. 数据劫持：是通过Object.defineProperty()来劫持对象属性的setter和getter操作。然后在数据变动时做出响应。
2. 发布者-订阅者模式：是消息队列的一种实现模式。概括起来，是将订阅者注册到发布者，那么发布者发布消息时，依次向订阅者发布消息。<br/>
为了实现这个模式，需要进行两个步骤：<br/>
i. 初始化发布者和订阅者<br/>
ii. 将订阅者注册到发布者

## II - 实现一个简易版的Vue，包括声明式数据渲染和一些简单的指令
思路分析：
1. 实现MVVM，包含两个方面，view变化更新model，model变化更新view
2. view变化更新model可以通过事件监听实现
3. 着重分析model变化更新view，重点在于要知道何时model发生了变化，这就要用到Object.defineProperty()对属性setter增加一个通知，告知我们属性发生了变化
<br/>
实现过程：<br/>
前面已经明确了如何实现数据双向绑定。首先就是要对数据进行劫持监听，这需要设置一个监听器Observer来监听所有属性。当属性变化时通知订阅者Watcher确定是否需要更新。由于属性可能是多个，所以会有多个订阅者，因此需要一个消息订阅器Dep（订阅者容器）来收集订阅者，并在监听器Observer和订阅者Watcher之间进行统一管理。由于在节点元素上可能存在一些指令，所以还需要一个指令解析器Compile，来对每个节点元素进行扫描和解析，将相关指令初始化为一个订阅者Watcher，替换模板数据并绑定相应的函数。<br/>
对以上思路进行整理后可以将双向绑定的实现基本分离为三个部分：<br/>
1. 实现一个监听器Observer，用来劫持并监听所有属性，一旦属性有变动就通知订阅者Watcher
2. 实现一个订阅者Watcher，接受属性变化的通知并执行相应操作，更新view
3. 实现一个指令解析器Compile，可以扫描和解析每个节点元素的相关指令，根据解析结果初始化模板数据和相应的订阅器<br/>

基本流程图如下：


